@page
@model LoginModel
@{
    ViewData["Title"] = "Log in";
    Layout = "_Layout";
}

<style>
    #hw-body {
        padding: 0;
        display: flex;
        align-items: stretch;
        min-height: calc(100vh - var(--hw-topbar-h));
    }

    .hw-login-wrap {
        display: flex;
        width: 100%;
        min-height: calc(100vh - var(--hw-topbar-h));
    }

    /* Left branding panel */
    .hw-login-left {
        width: 42%;
        flex-shrink: 0;
        background: linear-gradient(160deg, var(--hw-green-dark) 0%, var(--hw-green) 60%, #1e8c45 100%);
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        padding: 52px 48px;
        position: relative;
        overflow: hidden;
    }

        .hw-login-left::before {
            content: '';
            position: absolute;
            right: -80px;
            top: -80px;
            width: 320px;
            height: 320px;
            border-radius: 50%;
            background: rgba(230,176,0,.12);
            pointer-events: none;
        }

        .hw-login-left::after {
            content: '';
            position: absolute;
            left: -60px;
            bottom: -60px;
            width: 260px;
            height: 260px;
            border-radius: 50%;
            background: rgba(255,255,255,.06);
            pointer-events: none;
        }

    .hw-login-mark {
        display: flex;
        align-items: center;
        gap: 14px;
        margin-bottom: 52px;
    }

    .hw-login-mark-badge {
        width: 52px;
        height: 52px;
        flex-shrink: 0;
        background: var(--hw-gold);
        border-radius: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 800;
        font-size: 18px;
        color: var(--hw-green-dark);
        box-shadow: 0 4px 18px rgba(230,176,0,.38);
    }

    .hw-login-mark-name {
        font-size: 16px;
        font-weight: 800;
        color: #fff;
    }

    .hw-login-mark-sub {
        font-size: 10.5px;
        color: rgba(255,255,255,.5);
        letter-spacing: .05em;
        text-transform: uppercase;
        margin-top: 1px;
    }

    .hw-login-headline {
        font-size: 32px;
        font-weight: 800;
        color: #fff;
        letter-spacing: -.025em;
        line-height: 1.2;
        margin-bottom: 16px;
    }

        .hw-login-headline span {
            color: var(--hw-gold);
        }

    .hw-login-tagline {
        font-size: 14px;
        color: rgba(255,255,255,.65);
        line-height: 1.65;
        max-width: 320px;
    }

    .hw-login-features {
        margin-top: 36px;
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .hw-login-feat {
        display: flex;
        align-items: center;
        gap: 12px;
        background: rgba(255,255,255,.1);
        border: 1px solid rgba(255,255,255,.15);
        border-radius: 10px;
        padding: 11px 14px;
        backdrop-filter: blur(4px);
    }

    .hw-login-feat-icon {
        width: 34px;
        height: 34px;
        flex-shrink: 0;
        background: rgba(230,176,0,.2);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 15px;
        color: var(--hw-gold);
    }

    .hw-login-feat-title {
        font-size: 13px;
        font-weight: 700;
        color: #fff;
    }

    .hw-login-feat-desc {
        font-size: 11px;
        color: rgba(255,255,255,.5);
        margin-top: 1px;
    }

    .hw-login-left-foot {
        font-size: 11px;
        color: rgba(255,255,255,.35);
        line-height: 1.6;
        z-index: 1;
        position: relative;
    }

        .hw-login-left-foot strong {
            color: rgba(255,255,255,.55);
        }

    /* Right form panel */
    .hw-login-right {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 48px 40px;
        background: var(--hw-offwhite);
    }

    .hw-login-form-box {
        width: 100%;
        max-width: 420px;
    }

    .hw-form-eyebrow {
        font-size: 11px;
        font-weight: 700;
        letter-spacing: .1em;
        text-transform: uppercase;
        color: var(--hw-gold-dark);
        margin-bottom: 6px;
    }

    .hw-form-title {
        font-size: 24px;
        font-weight: 800;
        letter-spacing: -.025em;
        color: var(--hw-dark);
        margin-bottom: 4px;
    }

        .hw-form-title span {
            color: var(--hw-green);
        }

    .hw-form-sub {
        font-size: 13.5px;
        color: var(--hw-muted);
        margin-bottom: 28px;
        line-height: 1.55;
    }

    /* Model-level validation summary */
    .hw-val-summary {
        background: var(--hw-red-light);
        border: 1.5px solid #f5c6c2;
        border-radius: 8px;
        padding: 11px 14px;
        margin-bottom: 20px;
        font-size: 13px;
        color: var(--hw-red);
    }

        .hw-val-summary ul {
            margin: 6px 0 0;
            padding-left: 18px;
        }

    /* Fields */
    .hw-field {
        margin-bottom: 18px;
    }

    .hw-field-label {
        display: block;
        font-size: 12px;
        font-weight: 700;
        color: var(--hw-dark);
        margin-bottom: 6px;
    }

    .hw-field-wrap {
        position: relative;
    }

    .hw-field-ico {
        position: absolute;
        left: 13px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 15px;
        color: var(--hw-muted);
        pointer-events: none;
        transition: color .2s;
    }

    .hw-field-wrap:focus-within .hw-field-ico {
        color: var(--hw-green);
    }

    .hw-input {
        width: 100%;
        padding: 11px 13px 11px 38px;
        border: 1.5px solid var(--hw-border);
        border-radius: 9px;
        font-size: 14px;
        font-family: 'Geist Sans','Segoe UI',sans-serif;
        background: var(--hw-white);
        color: var(--hw-dark);
        outline: none;
        transition: border-color .2s, box-shadow .2s;
    }

        .hw-input:focus {
            border-color: var(--hw-green);
            box-shadow: 0 0 0 3px rgba(26,122,60,.11);
        }

        .hw-input.input-error {
            border-color: var(--hw-red);
        }

            .hw-input.input-error:focus {
                box-shadow: 0 0 0 3px rgba(192,57,43,.1);
            }

    /* Field validation error — styled via CSS, NO inner HTML in the span */
    .hw-field-error {
        font-size: 11.5px;
        color: var(--hw-red);
        margin-top: 5px;
        display: none;
        align-items: center;
        gap: 5px;
    }

        .hw-field-error.field-validation-error {
            display: flex;
        }

    /* Password toggle */
    #hw-pw-input {
        padding-right: 40px;
    }

    .hw-pwd-toggle {
        position: absolute;
        right: 12px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        cursor: pointer;
        color: var(--hw-muted);
        font-size: 15px;
        padding: 2px;
        transition: color .2s;
    }

        .hw-pwd-toggle:hover {
            color: var(--hw-green);
        }

    /* Remember me */
    .hw-remember {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 22px;
        cursor: pointer;
    }

        .hw-remember input[type=checkbox] {
            width: 16px;
            height: 16px;
            accent-color: var(--hw-green);
            cursor: pointer;
            flex-shrink: 0;
        }

        .hw-remember span {
            font-size: 13px;
            color: var(--hw-muted);
        }

    /* Submit */
    .hw-submit-btn {
        width: 100%;
        padding: 12px;
        background: var(--hw-green);
        color: #fff;
        border: none;
        border-radius: 9px;
        font-size: 14px;
        font-weight: 700;
        font-family: 'Geist Sans','Segoe UI',sans-serif;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        transition: background .2s, box-shadow .2s, transform .15s;
        margin-bottom: 20px;
    }

        .hw-submit-btn:hover {
            background: var(--hw-green-dark);
            box-shadow: 0 4px 18px rgba(26,122,60,.32);
            transform: translateY(-1px);
        }

        .hw-submit-btn:active {
            transform: none;
        }

        .hw-submit-btn:disabled {
            opacity: .75;
            transform: none;
            cursor: not-allowed;
        }

    .hw-btn-spinner {
        display: none;
        width: 16px;
        height: 16px;
        border: 2px solid rgba(255,255,255,.3);
        border-top-color: #fff;
        border-radius: 50%;
        animation: hwSpin .7s linear infinite;
    }

    /* Links */
    .hw-form-links {
        display: flex;
        flex-direction: column;
        gap: 8px;
        align-items: center;
        margin-bottom: 24px;
    }

    .hw-form-link {
        font-size: 13px;
        color: var(--hw-muted);
        text-decoration: none;
        transition: color .2s;
    }

        .hw-form-link:hover {
            color: var(--hw-green);
        }

        .hw-form-link strong {
            color: var(--hw-green);
            font-weight: 600;
        }

    /* External login divider + buttons */
    .hw-divider {
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 12px;
        color: var(--hw-muted);
        margin-bottom: 16px;
    }

        .hw-divider::before, .hw-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--hw-border);
        }

    .hw-ext-btns {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .hw-ext-btn {
        width: 100%;
        padding: 10px;
        border: 1.5px solid var(--hw-border);
        border-radius: 9px;
        background: var(--hw-white);
        font-size: 13px;
        font-weight: 600;
        font-family: 'Geist Sans','Segoe UI',sans-serif;
        color: var(--hw-dark);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        transition: border-color .2s, box-shadow .2s, background .2s;
    }

        .hw-ext-btn:hover {
            border-color: var(--hw-green);
            background: var(--hw-green-light);
            box-shadow: 0 2px 8px rgba(26,122,60,.1);
        }

    @@media (max-width: 900px) {
        .hw-login-left {
            display: none;
        }

        .hw-login-right {
            padding: 32px 20px;
        }

        #hw-body {
            align-items: flex-start;
        }
    }
</style>

<div class="hw-login-wrap">

    @* ══ LEFT panel ══ *@
    <div class="hw-login-left">
        <div>
            <div class="hw-login-mark">
                <div class="hw-login-mark-badge">IH</div>
                <div>
                    <div class="hw-login-mark-name">HWSETA Impact Hub</div>
                    <div class="hw-login-mark-sub">Health &amp; Welfare SETA</div>
                </div>
            </div>
            <h2 class="hw-login-headline">Beneficiary<br />Monitoring<br /><span>Made Simple.</span></h2>
            <p class="hw-login-tagline">
                A secure platform for tracking National Skills Development Plan 2030 beneficiaries — from enrolment to proof of completion.
            </p>
            <div class="hw-login-features">
                <div class="hw-login-feat">
                    <div class="hw-login-feat-icon"><i class="bi bi-people"></i></div>
                    <div><div class="hw-login-feat-title">Beneficiary Tracking</div><div class="hw-login-feat-desc">Monitor enrolment, progress, and completion status</div></div>
                </div>
                <div class="hw-login-feat">
                    <div class="hw-login-feat-icon"><i class="bi bi-ui-checks-grid"></i></div>
                    <div><div class="hw-login-feat-title">Dynamic Web Forms</div><div class="hw-login-feat-desc">Capture challenges, outcomes, and feedback iteratively</div></div>
                </div>
                <div class="hw-login-feat">
                    <div class="hw-login-feat-icon"><i class="bi bi-bar-chart-line"></i></div>
                    <div><div class="hw-login-feat-title">Reports &amp; Dashboards</div><div class="hw-login-feat-desc">Visual insights and downloadable data exports</div></div>
                </div>
            </div>
        </div>
        <div class="hw-login-left-foot">
            <strong>HWSETA · Ref: HWSETA-2025/26 EvalResearch-0007</strong><br />
            Health and Welfare Sector Education and Training Authority<br />
            &copy; @DateTime.Now.Year · All rights reserved
        </div>
    </div>

    @* ══ RIGHT panel ══ *@
    <div class="hw-login-right">
        <div class="hw-login-form-box">

            <div class="hw-form-eyebrow"><i class="bi bi-lock me-1"></i>Secure Access</div>
            <h1 class="hw-form-title">Welcome <span>Back</span></h1>
            <p class="hw-form-sub">Sign in to your account to continue.</p>

            @* Model-level errors only (e.g. "Invalid login attempt") *@
            @if (!ViewData.ModelState.IsValid &&
                        ViewData.ModelState.TryGetValue(string.Empty, out var rootEntry) &&
                        rootEntry.Errors.Count > 0)
            {
                <div class="hw-val-summary" role="alert">
                    <i class="bi bi-exclamation-circle-fill me-2"></i>
                    <strong>Please correct the following:</strong>
                    <ul>
                        @foreach (var err in rootEntry.Errors)
                        {
                            <li>@err.ErrorMessage</li>
                        }
                    </ul>
                </div>
            }

            <form id="account" method="post">
                @Html.AntiForgeryToken()

                @* Email *@
                <div class="hw-field">
                    <label asp-for="Input.Email" class="hw-field-label">Email Address</label>
                    <div class="hw-field-wrap">
                        <i class="bi bi-envelope hw-field-ico"></i>
                        <input asp-for="Input.Email"
                               class="hw-input"
                               autocomplete="username"
                               aria-required="true"
                               placeholder="you@example.com" />
                    </div>
                    @* Plain span — ASP.NET validation populates text content only.
                       No HTML inside the span to avoid raw-tag rendering. *@
                    <span asp-validation-for="Input.Email" class="hw-field-error"></span>
                </div>

                @* Password *@
                <div class="hw-field">
                    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:6px;">
                        <label asp-for="Input.Password" class="hw-field-label" style="margin:0;">Password</label>
                        <a asp-page="./ForgotPassword" id="forgot-password"
                           style="font-size:12px;color:var(--hw-green);font-weight:600;text-decoration:none;">
                            Forgot password?
                        </a>
                    </div>
                    <div class="hw-field-wrap">
                        <i class="bi bi-lock hw-field-ico"></i>
                        <input asp-for="Input.Password"
                               id="hw-pw-input"
                               class="hw-input"
                               autocomplete="current-password"
                               aria-required="true"
                               placeholder="Enter your password" />
                        <button type="button" class="hw-pwd-toggle" aria-label="Toggle password visibility" onclick="hwTogglePwd()">
                            <i class="bi bi-eye" id="hw-pwd-eye"></i>
                        </button>
                    </div>
                    <span asp-validation-for="Input.Password" class="hw-field-error"></span>
                </div>

                @* Remember me *@
                <label class="hw-remember">
                    <input class="form-check-input" asp-for="Input.RememberMe" />
                    <span>@Html.DisplayNameFor(m => m.Input.RememberMe)</span>
                </label>

                @* Submit *@
                <button id="login-submit" type="submit" class="hw-submit-btn">
                    <span id="hw-btn-label"><i class="bi bi-box-arrow-in-right"></i> Sign In</span>
                    <span class="hw-btn-spinner" id="hw-btn-spinner"></span>
                </button>

                <div class="hw-form-links">
                    <a asp-page="./Register" asp-route-returnUrl="@Model.ReturnUrl" class="hw-form-link">
                        Don't have an account? <strong>Register here</strong>
                    </a>
                    <a id="resend-confirmation" asp-page="./ResendEmailConfirmation" class="hw-form-link">
                        Resend email confirmation
                    </a>
                </div>

            </form>

            @* External logins *@
            @if ((Model.ExternalLogins?.Count ?? 0) > 0)
            {
                <div class="hw-divider">or continue with</div>
                <form id="external-account"
                      asp-page="./ExternalLogin"
                      asp-route-returnUrl="@Model.ReturnUrl"
                      method="post">
                    <div class="hw-ext-btns">
                        @foreach (var provider in Model.ExternalLogins!)
                        {
                            <button type="submit" class="hw-ext-btn"
                                    name="provider" value="@provider.Name"
                                    title="Sign in with @provider.DisplayName">
                                <i class="bi bi-box-arrow-in-right"></i>
                                @provider.DisplayName
                            </button>
                        }
                    </div>
                </form>
            }

        </div>
    </div>

</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        /* Password toggle */
        function hwTogglePwd() {
            var inp = document.getElementById('hw-pw-input');
            var eye = document.getElementById('hw-pwd-eye');
            inp.type = inp.type === 'password' ? 'text' : 'password';
            eye.className = inp.type === 'text' ? 'bi bi-eye-slash' : 'bi bi-eye';
        }

        /* Submit spinner — only fires when jQuery Validate is happy */
        document.getElementById('account').addEventListener('submit', function () {
            if (typeof $ !== 'undefined' && !$(this).valid()) return;
            var btn     = document.getElementById('login-submit');
            var label   = document.getElementById('hw-btn-label');
            var spinner = document.getElementById('hw-btn-spinner');
            label.style.display   = 'none';
            spinner.style.display = 'inline-block';
            btn.disabled = true;
        });

        /* Red border on server-side validation failure */
        document.addEventListener('DOMContentLoaded', function () {
            document.querySelectorAll('span[data-valmsg-for]').forEach(function (span) {
                if (span.textContent.trim()) {
                    var name = span.getAttribute('data-valmsg-for');
                    var inp  = document.querySelector('[name="' + name + '"]');
                    if (inp) inp.classList.add('input-error');
                }
            });
        });
    </script>
}

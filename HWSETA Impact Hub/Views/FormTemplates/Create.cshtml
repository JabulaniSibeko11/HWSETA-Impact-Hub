@model HWSETA_Impact_Hub.Models.ViewModels.Forms.FormTemplateCreateVm
@{
    ViewData["Title"] = "Create Form";
}

<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
<link href="~/css/createformcss.css" rel="stylesheet" />


<div style="display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:24px;flex-wrap:wrap;gap:12px;">
    <div>
        <div class="hw-page-eyebrow"><i class="bi bi-ui-checks-grid me-1"></i>Form Management</div>
        <h1 class="hw-page-title">Create <span>New Form</span></h1>
        <p class="hw-page-desc">Set up your form template. You'll add questions in the Builder after creating it.</p>
    </div>
    <a asp-action="Index" class="hw-btn-outline" style="margin-top:4px;">
        <i class="bi bi-arrow-left"></i> Back to Forms
    </a>
</div>

<div class="hw-create-wrap">

    @* ── Form card ── *@
    <div class="hw-card">
        <div class="hw-card-head">
            <div class="hw-card-icon green"><i class="bi bi-file-earmark-plus"></i></div>
            <div>
                <div class="hw-card-title">Form Details</div>
                <div class="hw-card-sub">Fields marked <span style="color:var(--hw-red);">*</span> are required</div>
            </div>
        </div>
        <div class="hw-card-body">
            @if (!ViewData.ModelState.IsValid &&
                        ViewData.ModelState.TryGetValue(string.Empty, out var rootEntry) &&
                        rootEntry.Errors.Count > 0)
            {
                <div class="hw-val-summary" role="alert">
                    <i class="bi bi-exclamation-circle-fill" style="flex-shrink:0;margin-top:1px;font-size:16px;"></i>
                    <div><strong>Please fix:</strong><ul>@foreach (var e in rootEntry.Errors) {
                    <li>@e.ErrorMessage</li>
                }
</ul></div>
            </div>
                        }
            <form method="post" id="hw-form">
                @Html.AntiForgeryToken()
                <div class="hw-field">
                    <label asp-for="Title" class="hw-field-label">Form Title <span class="hw-req">*</span></label>
                    <div class="hw-field-wrap">
                        <i class="bi bi-file-earmark-text hw-field-ico"></i>
                        <input asp-for="Title" class="hw-input"
                               placeholder="e.g. Monthly Progress Monitoring Form"
                               id="hw-title-input"
                               oninput="hwPreview()" />
                    </div>
                    <span asp-validation-for="Title" class="hw-field-error"></span>
                </div>
                <div class="hw-field">
                    <label asp-for="Description" class="hw-field-label">Description <span style="font-weight:400;color:var(--hw-muted);">(optional)</span></label>
                    <textarea asp-for="Description" class="hw-textarea"
                              rows="4"
                              placeholder="Brief description of this form's purpose — shown to respondents before they begin."
                              id="hw-desc-input"
                              oninput="hwPreview()"></textarea>
                    <span asp-validation-for="Description" class="hw-field-error"></span>
                    <div class="hw-field-hint">
                        <i class="bi bi-info-circle me-1" style="color:var(--hw-gold-dark);"></i>
                        After creating the form you'll be taken directly to the Builder to add sections and questions.
                    </div>
                </div>
            </form>
        </div>
        <div class="hw-card-foot">
            <button type="submit" form="hw-form" class="hw-btn-primary">
                <i class="bi bi-tools"></i> Create &amp; Open Builder
            </button>
            <a asp-action="Index" class="hw-btn-outline">
                <i class="bi bi-x"></i> Cancel
            </a>
        </div>
    </div>

    @* ── Sidebar ── *@
    <div style="display:flex;flex-direction:column;gap:16px;">

        @* Live preview *@
        <div class="hw-preview-card">
            <div class="hw-preview-label">Live Preview</div>
            <div class="hw-preview-title" id="hw-preview-title">Your form title will appear here</div>
            <div class="hw-preview-desc" id="hw-preview-desc">Description will appear here once entered…</div>
            <div class="hw-preview-badge">
                <i class="bi bi-pencil-square"></i> Draft · Version 1
            </div>
        </div>

        @* Builder guide *@
        <div class="hw-card">
            <div class="hw-card-head">
                <div class="hw-card-icon gold"><i class="bi bi-lightbulb"></i></div>
                <div>
                    <div class="hw-card-title">What happens next?</div>
                </div>
            </div>
            <div class="hw-card-body" style="padding:18px 20px;">
                <ul class="hw-tip-list">
                    <li class="hw-tip-item">
                        <i class="bi bi-1-circle-fill"></i>
                        Create the form here with a title and description.
                    </li>
                    <li class="hw-tip-item">
                        <i class="bi bi-2-circle-fill"></i>
                        You'll land in the <strong>Builder</strong> — add sections to group related questions.
                    </li>
                    <li class="hw-tip-item">
                        <i class="bi bi-3-circle-fill"></i>
                        Add questions to each section. Choose from 14 field types (text, dropdowns, ratings, file uploads etc.)
                    </li>
                    <li class="hw-tip-item">
                        <i class="bi bi-4-circle-fill"></i>
                        Click <strong>Publish</strong> to generate a public link and enable submissions.
                    </li>
                    <li class="hw-tip-item">
                        <i class="bi bi-check-circle-fill"></i>
                        Track all responses in <strong>Submissions</strong> from the Forms list.
                    </li>
                </ul>
            </div>
        </div>

    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        function hwPreview() {
            var title = document.getElementById('hw-title-input').value.trim();
            var desc  = document.getElementById('hw-desc-input').value.trim();
            document.getElementById('hw-preview-title').textContent = title || 'Your form title will appear here';
            document.getElementById('hw-preview-desc').textContent  = desc  || 'Description will appear here once entered…';
        }
        // Mark error inputs on server validation
        document.addEventListener('DOMContentLoaded', function () {
            document.querySelectorAll('span[data-valmsg-for]').forEach(function (span) {
                if (span.textContent.trim()) {
                    var name = span.getAttribute('data-valmsg-for');
                    var inp  = document.querySelector('[name="' + name + '"]');
                    if (inp) inp.classList.add('input-error');
                }
            });
        });
    </script>
}

@model HWSETA_Impact_Hub.Models.ViewModels.Registrations.SetPasswordVm
@{
    ViewData["Title"] = "Set Password";
}
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />


<link href="~/css/setpasswordcss.css" rel="stylesheet" />

<div class="hw-overlay">
    <div class="hw-modal">
        <div class="hw-modal-hero">
            <div class="hw-key-ring"><i class="bi bi-key-fill" style="font-family:unset !important;"></i></div>
            <div class="hw-modal-hero-title">Set Your Password</div>
            <div class="hw-modal-hero-sub">Create a secure password to access your HWSETA profile after registration.</div>
            <div class="hw-steps">
                <div class="hw-step done">
                    <div class="hw-step-dot"><i class="bi bi-check" style="font-size:11px;font-family:unset !important;"></i></div>
                    <span class="hw-step-label">Details</span>
                    <div class="hw-step-line"></div>
                </div>
                <div class="hw-step done">
                    <div class="hw-step-dot"><i class="bi bi-check" style="font-size:11px;font-family:unset !important;"></i></div>
                    <span class="hw-step-label">Location</span>
                    <div class="hw-step-line"></div>
                </div>
                <div class="hw-step active">
                    <div class="hw-step-dot"><i class="bi bi-key" style="font-size:10px;font-family:unset !important;"></i></div>
                    <span class="hw-step-label">Password</span>
                </div>
            </div>
        </div>
        <div class="hw-modal-body">
            <form asp-action="SetPassword" asp-controller="Registration" method="post">
                @Html.AntiForgeryToken()
                <input type="hidden" asp-for="Token" />

                <div class="hw-field">
                    <label asp-for="Email" class="hw-field-label">Email Address</label>
                    <div class="hw-field-wrap">
                        <i class="bi bi-envelope hw-field-ico"></i>
                        <input asp-for="Email" class="hw-input" placeholder="your@email.co.za" type="email" autocomplete="email" />
                    </div>
                    <span asp-validation-for="Email" class="hw-field-error"></span>
                </div>

                <div class="hw-field">
                    <label asp-for="Password" class="hw-field-label">New Password</label>
                    <div class="hw-field-wrap">
                        <i class="bi bi-lock hw-field-ico"></i>
                        <input asp-for="Password" type="password" class="hw-input" placeholder="Create a strong password" autocomplete="new-password" id="hw-pw" oninput="hwStrength(this.value)" />
                        <button type="button" class="hw-pw-toggle" onclick="hwTogglePw('hw-pw', 'hw-eye1')" tabindex="-1">
                            <i class="bi bi-eye" id="hw-eye1" style="font-family:unset !important;"></i>
                        </button>
                    </div>
                    <div class="hw-strength-wrap" id="hw-strength-wrap" style="display:none;">
                        <div class="hw-strength-bar"><div class="hw-strength-fill" id="hw-str-fill"></div></div>
                        <div class="hw-strength-label" id="hw-str-label"></div>
                    </div>
                    <span asp-validation-for="Password" class="hw-field-error"></span>
                </div>

                @* Password requirements *@
                <div class="hw-req-list" id="hw-req-list">
                    <div class="hw-req-item" id="req-len"><i class="bi bi-x-circle" style="font-family:unset !important;"></i>At least 8 characters</div>
                    <div class="hw-req-item" id="req-upper"><i class="bi bi-x-circle" style="font-family:unset !important;"></i>One uppercase letter (A–Z)</div>
                    <div class="hw-req-item" id="req-num"><i class="bi bi-x-circle" style="font-family:unset !important;"></i>One number (0–9)</div>
                    <div class="hw-req-item" id="req-special"><i class="bi bi-x-circle" style="font-family:unset !important;"></i>One special character (!@@#$…)</div>
                </div>

                <div class="hw-field">
                    <label asp-for="ConfirmPassword" class="hw-field-label">Confirm Password</label>
                    <div class="hw-field-wrap">
                        <i class="bi bi-lock-fill hw-field-ico"></i>
                        <input asp-for="ConfirmPassword" type="password" class="hw-input" placeholder="Re-enter your password" autocomplete="new-password" id="hw-pw2" oninput="hwMatchCheck()" />
                        <button type="button" class="hw-pw-toggle" onclick="hwTogglePw('hw-pw2', 'hw-eye2')" tabindex="-1">
                            <i class="bi bi-eye" id="hw-eye2" style="font-family:unset !important;"></i>
                        </button>
                    </div>
                    <span asp-validation-for="ConfirmPassword" class="hw-field-error"></span>
                </div>

                <button class="hw-btn-primary" type="submit">
                    <i class="bi bi-check-lg" style="font-family:unset !important;"></i> Create Account &amp; Continue
                </button>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        function hwTogglePw(id, eyeId){
            var inp = document.getElementById(id);
            var ico = document.getElementById(eyeId);
            if(inp.type === 'password'){
                inp.type = 'text';
                ico.className = 'bi bi-eye-slash';
            } else {
                inp.type = 'password';
                ico.className = 'bi bi-eye';
            }
        }

        function setReq(id, met){
            var el = document.getElementById(id);
            if(!el) return;
            el.classList.toggle('met', met);
            el.querySelector('i').className = met ? 'bi bi-check-circle-fill' : 'bi bi-x-circle';
            el.querySelector('i').style.fontFamily = 'unset';
        }

        function hwStrength(v){
            document.getElementById('hw-strength-wrap').style.display = v ? 'block' : 'none';
            var hasLen = v.length >= 8;
            var hasUp  = /[A-Z]/.test(v);
            var hasNum = /[0-9]/.test(v);
            var hasSp  = /[^A-Za-z0-9]/.test(v);

            setReq('req-len', hasLen);
            setReq('req-upper', hasUp);
            setReq('req-num', hasNum);
            setReq('req-special', hasSp);

            var score = [hasLen, hasUp, hasNum, hasSp].filter(Boolean).length;
            var fill  = document.getElementById('hw-str-fill');
            var label = document.getElementById('hw-str-label');
            var w     = ['0%','30%','55%','80%','100%'][score];
            var c     = ['#e5e7eb','var(--red)','var(--gold)','var(--gold-dark)','var(--green)'][score];
            var t     = ['','Weak','Fair','Good','Strong'][score];
            fill.style.width      = w;
            fill.style.background = c;
            label.textContent     = t;
            label.style.color     = c;
        }

        function hwMatchCheck(){
            var p1 = document.getElementById('hw-pw').value;
            var p2 = document.getElementById('hw-pw2');
            p2.style.borderColor = (p2.value && p2.value !== p1) ? 'var(--red)' : '';
        }

        document.addEventListener('DOMContentLoaded', function(){
            document.querySelectorAll('span[data-valmsg-for]').forEach(function(span){
                if(span.textContent.trim()){
                    var inp = document.querySelector('[name="'+span.getAttribute('data-valmsg-for')+'"]');
                    if(inp) inp.classList.add('input-error');
                }
            });
        });
    </script>
}

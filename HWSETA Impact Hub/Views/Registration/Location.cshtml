@model HWSETA_Impact_Hub.Models.ViewModels.Registrations.LocationVm
@{
    ViewData["Title"] = "Location Permission";
}

<h2>Location Access Required</h2>
<p>We need your location to continue with registration.</p>

<form id="locForm" asp-action="SaveLocation" asp-controller="Registration" method="post">
    @Html.AntiForgeryToken()
    <input type="hidden" asp-for="Token" />
    <input type="hidden" asp-for="Latitude" />
    <input type="hidden" asp-for="Longitude" />

    <button type="button" class="btn btn-primary" onclick="getLocation()">Allow Location</button>
</form>

<div id="msg" class="mt-3 text-muted"></div>

<script>
    function getLocation() {
        const msg = document.getElementById("msg");
        msg.innerText = "Requesting location...";

        if (!navigator.geolocation) {
            msg.innerText = "Geolocation is not supported by this device/browser.";
            return;
        }

        navigator.geolocation.getCurrentPosition(
            (pos) => {
                document.querySelector("input[name='Latitude']").value = pos.coords.latitude;
                document.querySelector("input[name='Longitude']").value = pos.coords.longitude;
                document.getElementById("locForm").submit();
            },
            (err) => {
                msg.innerText = "Location permission is required to continue. Please allow location.";
            },
            { enableHighAccuracy: true, timeout: 10000 }
        );
    }
</script>